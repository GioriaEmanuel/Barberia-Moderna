let paso=1;const init=1,final=3,cita={nombre:"",usuarioID:"",fecha:"",hora:"",servicios:[]};function iniciarapp(){Tabs()}function Tabs(){document.querySelectorAll(".navegacion a").forEach((function(e){e.addEventListener("click",(function(t){paso=parseInt(e.dataset.paso),mostrarseccion(),paginador()}))}))}function mostrarseccion(){let e=document.querySelector(".mostrar"),t=document.querySelector(".seleccionado");e&&(e.classList.remove("mostrar"),t.classList.remove("seleccionado")),document.querySelector("#paso-"+paso).classList.add("mostrar"),document.querySelector(`[data-paso="${paso}"]`).classList.add("seleccionado")}function paginador(){let e=document.querySelector("#siguiente"),t=document.querySelector("#anterior");1===paso?(t.classList.add("ocultar"),e.classList.remove("ocultar")):3===paso?(e.classList.add("ocultar"),t.classList.remove("ocultar"),mostrarResumen()):(t.classList.remove("ocultar"),e.classList.remove("ocultar"))}function paginaAnt(){document.querySelector("#anterior").addEventListener("click",(function(){paso-=1,mostrarseccion(),paginador()}))}function paginaSig(){document.querySelector("#siguiente").addEventListener("click",(function(){paso+=1,mostrarseccion(),paginador()}))}async function consultarAPI(){try{const e=location.origin+"/api/servicios";console.log(e);const t=await fetch(e);mostrarDatos(await t.json())}catch(e){console.log(e)}}function mostrarDatos(e){e.forEach(e=>{const{id:t,nombre:o,precio:a}=e,n=document.createElement("P");n.textContent=o,n.classList.add("nombreservicio");const c=document.createElement("P");c.textContent="$ "+a,c.classList.add("precioservicio");const r=document.createElement("DIV");r.classList.add("servicios"),r.dataset.idServicio=t,r.appendChild(n),r.appendChild(c);document.querySelector(".listado-servicios").appendChild(r),r.onclick=function(){seleccionarServicio(e)}})}function seleccionarServicio(e){const{servicios:t}=cita,{id:o}=e;t.some((function(e){return e.id===o}))?cita.servicios=t.filter(e=>e.id!==o):cita.servicios=[...t,e];document.querySelector(`[data-id-servicio="${o}"]`).classList.toggle("seleccionado")}function nombreClienteYid(){cita.nombre=document.querySelector("[data-nombre]").dataset.nombre,cita.usuarioID=document.querySelector("[data-id]").dataset.id}function fechaCita(){document.querySelector("#fecha").addEventListener("input",(function(e){const t=new Date(e.target.value).getUTCDay();[6,0].includes(t)?(e.target.value=null,mostrarAlerta("Dias Sabados y Domingos cerrados","error",!0,".formulario")):cita.fecha=e.target.value}))}function horaCita(){document.querySelector("#hora").addEventListener("input",(function(e){e.target.value<="09:00"||e.target.value>="18:00"?(mostrarAlerta("Hora incorrecta","error",!0,".formulario"),e.target.value=""):cita.hora=e.target.value}))}function mostrarResumen(){const e=document.querySelector("#paso-3");let t=0;for(;e.firstChild;)e.removeChild(e.firstChild);if(Object.values(cita).includes("")||0===cita.servicios.length)return void mostrarAlerta("Hacen falta datos","error",!1,"#paso-3");const{nombre:o,fecha:a,hora:n,servicios:c}=cita,r=new Date(a),i=r.getDate(),s=r.getMonth(),d=r.getFullYear();fechaUTC=new Date(Date.UTC(d,s,i));const l=fechaUTC.toLocaleDateString("es-AR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),u=document.createElement("DIV");u.classList.add("contenedor-servicios");const m=document.createElement("P");m.innerHTML=" <span>Nombre:</span> "+o;const p=document.createElement("P");p.innerHTML=` <span> Fecha : </span>${l} `;const f=document.createElement("P");f.innerHTML=` <span> Hora :</span> ${n} `;const v=document.createElement("H4");u.appendChild(m),u.appendChild(p),u.appendChild(f),c.forEach((function(o){const a=document.createElement("DIV"),n=document.createElement("P");n.innerHTML=` <span> Servicio :</span> ${o.nombre} `,a.appendChild(n);const c=document.createElement("P");c.innerHTML=` <span> Coste :</span> $${o.precio} `,a.appendChild(c),a.classList.add("precio"),t+=parseInt(o.precio),e.appendChild(a)})),v.textContent="Total Gastado : $"+t,u.appendChild(v),e.appendChild(u);const h=document.createElement("button");h.classList.add("boton"),h.textContent="Reservar",e.appendChild(h),h.onclick=reservarcita}async function reservarcita(){const e=new FormData,{nombre:t,fecha:o,hora:a,servicios:n,usuarioID:c}=cita,r=n.map(e=>e.id);e.append("fecha",o),e.append("hora",a),e.append("servicios",r),e.append("usuario_id",c),console.log(e);try{const t=location.origin+"/api/servicios",o=await fetch(t,{method:"POST",body:e}),a=await o.json();console.log(a),a&&Swal.fire({position:"center-center",icon:"success",title:"Su cita ha sido Reservada",showConfirmButton:!1,timer:2500}).then(()=>window.location.reload())}catch(e){Swal.fire({icon:"error",title:"Oops...",text:"Ha ocurrido un error, vuelva a intentarlo en unos minutos",footer:'<a href="/cita">volver al inicio</a>'})}}function mostrarAlerta(e,t,o=!0,a){const n=document.querySelector(".error");n&&n.remove();const c=document.createElement("DIV");c.textContent=e,c.classList.add(t);document.querySelector(a).appendChild(c),o&&setTimeout(()=>{c.remove()},3e3)}document.addEventListener("DOMContentLoaded",(function(){iniciarapp(),consultarAPI(),paginador(),paginaSig(),paginaAnt(),nombreClienteYid(),fechaCita(),horaCita(),mostrarResumen(),mostrarseccion()}));